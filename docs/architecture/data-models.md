# Data Models

These TypeScript interfaces define the **MVP-essential** business entities shared between frontend and backend. All models support the four-section dashboard categorization logic from the PRD requirements while following YAGNI principles.

**Auth.js Integration Strategy:** Using Auth.js v5 with **Database Strategy + Prisma Adapter** for optimal serverless performance and enterprise readiness. Auth.js manages core authentication tables (`User`, `Account`, `Session`) while CodeFlow manages minimal user configuration data only.

**MVP Data Strategy:** **GitHub API as single source of truth** - No PR data storage in database. All PR information fetched directly from GitHub API with TanStack Query providing intelligent client-side caching. Database stores only user profiles and repository monitoring preferences.

**MVP Scope:** These models support **Phase 1-2** (GitHub authentication + basic dashboard). Advanced features like Slack integration, notification auditing, and user preferences are post-MVP additions.

### Auth.js Core Tables (Managed by NextAuth.js)

Auth.js will automatically manage these tables via Prisma adapter:

```typescript
// Auth.js managed tables (auto-generated by @auth/prisma-adapter)
interface User {
  id: string;
  name: string | null;
  email: string | null;
  emailVerified: Date | null;
  image: string | null;
}

interface Account {
  id: string;
  userId: string;
  type: string;
  provider: string; // "github"
  providerAccountId: string; // GitHub user ID
  refresh_token: string | null;
  access_token: string | null;
  expires_at: number | null;
  token_type: string | null;
  scope: string | null;
  id_token: string | null;
  session_state: string | null;
}

interface Session {
  id: string;
  sessionToken: string;
  userId: string;
  expires: Date;
}
```

### CodeFlow MVP Models (Database Storage Only)

### User Profile Model

**Purpose:** Essential GitHub user data extending Auth.js User for repository management and monitoring preferences

**Key Attributes:**
- `id`: string (UUID) - Primary identifier, **foreign key to Auth.js User.id**
- `githubId`: number - GitHub user identifier for API calls (from Account.providerAccountId)
- `username`: string - GitHub username for display
- `lastActiveAt`: Date - Last dashboard activity for cleanup
- `createdAt`: Date - Account creation timestamp
- `updatedAt`: Date - Last profile modification

```typescript
interface UserProfile {
  id: string; // Foreign key to Auth.js User.id
  githubId: number; // From Account.providerAccountId
  username: string; // From GitHub OAuth
  lastActiveAt: Date;
  createdAt: Date;
  updatedAt: Date;
}
```

**Relationships:**
- **One-to-One:** UserProfile → Auth.js User (extends authentication)
- **One-to-Many:** UserProfile → Repository (monitored repositories)

**Auth.js Integration Notes:**
- GitHub `access_token` and `refresh_token` stored in Auth.js `Account` table (encrypted by Auth.js)
- User email, name, avatar from Auth.js `User` table  
- Session management handled by Auth.js `Session` table
- Token refresh handled automatically by Auth.js GitHub provider

### Repository Model

**Purpose:** GitHub repository monitoring configuration - stores which repositories user wants to track in dashboard

**Key Attributes:**
- `id`: string (UUID) - Primary identifier
- `githubId`: number - GitHub repository identifier
- `name`: string - Repository name (e.g., "code-flow-bmad")
- `fullName`: string - Full repository path (e.g., "owner/code-flow-bmad")
- `owner`: string - Repository owner username
- `isActive`: boolean - Whether monitoring is enabled
- `userId`: string - Foreign key to UserProfile
- `createdAt`: Date - Repository added to monitoring
- `updatedAt`: Date - Last configuration change

```typescript
interface Repository {
  id: string;
  githubId: number;
  name: string;
  fullName: string;
  owner: string;
  isActive: boolean;
  userId: string; // Foreign key
  createdAt: Date;
  updatedAt: Date;
}
```

**Relationships:**
- **Many-to-One:** Repository → UserProfile (repository owner)

**Note:** All repository metadata (description, language, default branch, etc.) fetched live from GitHub API, not stored in database.
